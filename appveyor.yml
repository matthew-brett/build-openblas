# vim ft=yaml
# CI on Windows via appveyor

environment:
    global:
      WHEELHOUSE_UPLOADER_USERNAME: travis-worker
      LIBNAME_SUFFIX: mingwpy
      MINGWPY_URL: https://8f55531b0432ac914da3-7f407ad05f03da00978ba0b8ec6c202f.ssl.cf2.rackcdn.com

    matrix:
      - ARCH: 64
        GCC_FNAME: x86_64-5.3.0-static-release-win32-seh-rt_v4-rev20160317.7z
        GCC_ROOT: mingw64

build_script:
  - git submodule update --init --recursive
  - set PATH=C:\msys64\usr\bin;%PATH%
  - pacman -Sy --noconfirm p7zip
  # Debug
  - pacman -Sy --noconfirm git svn zip tar autoconf make libtool automake
    p7zip patch bison gettext-devel wget sshpass texinfo
  - curl -L "%MINGWPY_URL%/%GCC_FNAME%" -o gcc.7z
  - bash -c "7z x gcc.7z"
  - SET PATH=%cd%\%GCC_ROOT%\bin;%PATH%
  - dir
  - gcc -dumpspecs
  - cd OpenBLAS
  - make BINARY=%ARCH% DYNAMIC_ARCH=1 USE_THREAD=1 USE_OPENMP=0
    NUM_THREADS=24 NO_WARMUP=1 NO_AFFINITY=1 CONSISTENT_FPCSR=1
    BUILD_LAPACK_DEPRECATED=1 MAX_STACK_ALLOC=2048
  - make PREFIX=c:\opt\%ARCH% install
  - dir c:\opt\%ARCH%\bin
